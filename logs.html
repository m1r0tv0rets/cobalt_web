<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Майнкрафт Логи</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="Images/icon.png">
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0ea5e9',
            dark: '#0f172a',
            minecraft: '#4CAF50',
            error: '#f87171',
            warning: '#fbbf24',
            success: '#34d399',
            diagnostic: '#0ea5e9',
            reminder: '#f59e0b'
          },
          animation: {
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'float': 'float 6s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
    
    body {
      font-family: 'Montserrat', sans-serif;
      scroll-behavior: smooth;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      color: #f1f5f9;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .scrolled {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }
    
    .diagnostic-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      background: linear-gradient(145deg, #1e293b, #0f172a);
      border: 1px solid rgba(14, 165, 233, 0.2);
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .diagnostic-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.3);
    }
    
    .diagnostic-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #0ea5e9, #0284c7, #0ea5e9);
      z-index: -1;
      border-radius: 14px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .diagnostic-card:hover::before {
      opacity: 1;
    }
    
    .btn-diagnostic {
      background: linear-gradient(135deg, #0ea5e9, #0284c7);
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(2, 132, 199, 0.3);
    }
    
    .btn-diagnostic:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(2, 132, 199, 0.5);
    }
    
    .btn-diagnostic:active {
      transform: translateY(1px);
    }
    
    .glow {
      text-shadow: 0 0 15px rgba(14, 165, 233, 0.7);
    }
    
    .error-highlight {
      background: rgba(248, 113, 113, 0.2);
      border-left: 3px solid #f87171;
      padding: 0.25rem 0.5rem;
      margin: 0.25rem 0;
    }
    
    .warning-highlight {
      background: rgba(251, 191, 36, 0.2);
      border-left: 3px solid #fbbf24;
      padding: 0.25rem 0.5rem;
      margin: 0.25rem 0;
    }
    
    .solution-card {
      background: rgba(52, 211, 153, 0.1);
      border-left: 3px solid #34d399;
    }
    
    .file-drop-area {
      border: 2px dashed rgba(14, 165, 233, 0.5);
      border-radius: 12px;
      padding: 3rem 2rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      background: rgba(30, 41, 59, 0.3);
    }
    
    .file-drop-area.active {
      border-color: #0ea5e9;
      background: rgba(14, 165, 233, 0.1);
    }
    
    .log-line {
      font-family: monospace;
      padding: 0.1rem 0.5rem;
      border-radius: 2px;
      margin: 0.1rem 0;
      font-size: 0.9rem;
    }
    
    .log-line:hover {
      background: rgba(14, 165, 233, 0.1);
    }
    
    .error-tag {
      background: rgba(248, 113, 113, 0.3);
      color: #f87171;
      border-radius: 4px;
      padding: 0.1rem 0.5rem;
      font-size: 0.75rem;
      margin-right: 0.5rem;
    }
    
    .warning-tag {
      background: rgba(251, 191, 36, 0.3);
      color: #fbbf24;
      border-radius: 4px;
      padding: 0.1rem 0.5rem;
      font-size: 0.75rem;
      margin-right: 0.5rem;
    }
    
    .severity-critical {
      background: rgba(220, 38, 38, 0.3);
      border-left: 4px solid #dc2626;
    }
    
    .severity-high {
      background: rgba(248, 113, 113, 0.3);
      border-left: 4px solid #f87171;
    }
    
    .severity-medium {
      background: rgba(251, 191, 36, 0.3);
      border-left: 4px solid #fbbf24;
    }
    
    .severity-low {
      background: rgba(59, 130, 246, 0.3);
      border-left: 4px solid #3b82f6;
    }
    
    .log-container {
      max-height: 300px;
      overflow-y: auto;
      background: rgba(15, 23, 42, 0.7);
      border-radius: 8px;
      padding: 0.5rem;
    }
    
    .main-content {
      flex: 1;
    }
    
    .diagnostic-icon {
      font-size: 1.5rem;
      margin-right: 0.5rem;
      transition: transform 0.3s ease;
    }
    
    .diagnostic-form {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      backdrop-filter: blur(10px);
      padding: 2rem;
      border: 1px solid rgba(14, 165, 233, 0.2);
    }
    
    .form-input {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(14, 165, 233, 0.3);
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #0ea5e9;
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.3);
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      background: rgba(30, 41, 59, 0.3);
      border-radius: 12px;
      border: 2px dashed rgba(14, 165, 233, 0.3);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      color: white;
      padding: 1rem 2rem;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      transform: translateX(120%);
      transition: transform 0.4s ease;
      z-index: 1000;
      max-width: 350px;
      border-left: 4px solid #0ea5e9;
      background: #1e293b;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background: #dc2626;
      border-left: 4px solid #b91c1c;
    }
    
    .notification.success {
      background: #16a34a;
      border-left: 4px solid #15803d;
    }
    
    .notification-title {
      display: flex;
      align-items: center;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: white;
    }
    
    .log-input {
      background: rgba(30, 41, 59, 0.7);
      border: 2px solid rgba(14, 165, 233, 0.3);
      color: #f1f5f9;
      border-radius: 12px;
      padding: 1.5rem;
      font-family: monospace;
      resize: none;
      min-height: 300px;
      width: 100%;
      transition: border-color 0.3s ease;
    }
    
    .log-input:focus {
      outline: none;
      border-color: #0ea5e9;
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.3);
    }
    
    .result-card {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(14, 165, 233, 0.2);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
    }
    
    .grid-pattern {
      background-image: 
        linear-gradient(rgba(14, 165, 233, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(14, 165, 233, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    
    .reminder-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #f59e0b;
      box-shadow: 0 0 10px rgba(245, 158, 11, 0.7);
      animation: pulse 1.5s infinite;
    }

    .mobile-button-spacing {
      gap: 12px;
    }

    .support-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 1rem;
    }

    .support-button {
      flex: 1;
      min-width: 200px;
    }

    @media (max-width: 640px) {
      .mobile-button-spacing {
        gap: 8px;
      }
      .support-buttons {
        flex-direction: column;
      }
      .support-button {
        min-width: auto;
      }
    }

    .spinner {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <main class="main-content py-10 px-4">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="diagnostic-card p-6" data-aos="fade-right">
          <div class="text-center mb-6">
            <div class="text-primary text-4xl mb-4">
              <i class="fas fa-file-upload"></i>
            </div>
            <h3 class="text-2xl font-bold mb-3 text-white">Загрузка логов</h3>
            <p class="text-gray-300 mb-6">
              Определяем более 100 типов ошибок Minecraft: проблемы с модами, видеодрайверами, памятью, конфликты версий и многое другое.
            </p>
          </div>
          
          <div id="fileDropArea" class="file-drop-area mb-6">
            <i class="fas fa-file-upload text-4xl text-primary mb-4"></i>
            <p class="text-lg font-medium mb-2">Перетащите сюда файл лога</p>
            <p class="text-gray-400 mb-4">Или нажмите для выбора файла</p>
            <input type="file" id="fileInput" class="hidden" accept=".log,.txt">
            <button id="fileSelectBtn" class="btn-diagnostic px-4 py-2 rounded-lg font-medium text-white">
              Выбрать файл
            </button>
          </div>
          
          <div class="mb-6">
            <label class="block text-gray-300 mb-2">Или вставьте текст лога:</label>
            <textarea id="logInput" class="log-input" placeholder="Вставьте сюда содержимое лог-файла или краш-репорта..."></textarea>
          </div>
          
          <div class="flex justify-between mobile-button-spacing">
            <button id="clearBtn" class="px-4 py-2 rounded-lg font-medium text-gray-300 border border-gray-600 hover:bg-gray-700 transition-colors">
              <i class="fas fa-trash mr-2"></i> Очистить
            </button>
            <button id="analyzeBtn" class="btn-diagnostic px-6 py-2 rounded-lg font-medium text-white">
              <i class="fas fa-search mr-2"></i> Анализировать
            </button>
          </div>
          
          <div class="support-buttons">
            <a href="https://t.me/tl_chat_ru/687311" class="btn-diagnostic support-button py-1.5 rounded-lg font-medium text-white text-sm">
              <i class="fas fa-paper-plane mr-2"></i> Отправить лог в поддержку Legacy
            </button>
          </div>
          <p class="text-xs text-center text-gray-400 mt-2">Отправьте свой лог в поддержку в виде файла</p>
        </div>
        
        <div class="diagnostic-card p-6" data-aos="fade-left">
          <div class="text-center mb-6">
            <div class="text-primary text-4xl mb-4">
              <i class="fas fa-lightbulb"></i>
            </div>
            <h3 class="text-2xl font-bold mb-3 text-white">Результаты диагностики</h3>
            <p class="text-gray-300 mb-6">
              Здесь отображаются найденные ошибки и рекомендации по их устранению.
            </p>
          </div>
          
          <div id="resultContainer" class="hidden">
            <div class="mb-6">
              <h4 class="text-lg font-bold text-white mb-3 flex items-center">
                <i class="fas fa-list mr-2 text-primary"></i> Сводка ошибок:
              </h4>
              <div id="errorSummary" class="mb-6 p-4 rounded-lg bg-gray-800"></div>
              
              <h4 class="text-lg font-bold text-white mb-3 flex items-center">
                <i class="fas fa-bug mr-2 text-primary"></i> Детали ошибок:
              </h4>
              <div id="errorDetails" class="space-y-4"></div>
            </div>
            
            <div class="solution-card p-4 rounded-lg">
              <h4 class="text-lg font-bold text-white mb-3 flex items-center">
                <i class="fas fa-wrench text-success mr-2"></i> Рекомендуемые решения:
              </h4>
              <div id="solutions" class="space-y-3"></div>
            </div>
          </div>
          
          <div id="emptyResult" class="text-center py-12">
            <i class="fas fa-file-invoice text-4xl text-gray-500 mb-4"></i>
            <p class="text-gray-500">Результаты анализа появятся здесь после обработки лога</p>
          </div>
          
          <div class="mt-6">
            <h4 class="text-lg font-bold text-white mb-3 flex items-center">
              <i class="fas fa-history mr-2 text-primary"></i> История анализа:
            </h4>
            <div class="log-container">
              <div id="logHistory" class="space-y-1"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="mt-16">
        <h2 class="text-2xl font-bold mb-6 text-white flex items-center" data-aos="fade-up">
          <i class="fas fa-puzzle-piece text-primary mr-3"></i> Советы по исправлению проблем с модами
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="diagnostic-card p-6" data-aos="fade-up">
            <h3 class="text-xl font-bold mb-4 text-white flex items-center">
              <i class="fas fa-exclamation-triangle text-warning mr-2"></i> Решение конфликтов модов
            </h3>
            <ul class="space-y-3 text-gray-300">
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Убедитесь, что все моды совместимы с вашей версией Minecraft</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Проверьте зависимости модов - возможно, не хватает библиотек</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Удалите моды по одному, чтобы найти конфликтующий</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Обновите моды до последних версий</span>
              </li>
            </ul>
          </div>
          
          <div class="diagnostic-card p-6" data-aos="fade-up" data-aos-delay="100">
            <h3 class="text-xl font-bold mb-4 text-white flex items-center">
              <i class="fas fa-sync-alt text-primary mr-2"></i> Оптимизация работы модов
            </h3>
            <ul class="space-y-3 text-gray-300">
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Установите моды оптимизации (OptiFine, Sodium)</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Увеличьте выделенную память для Java в настройках лаунчера</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Удалите неиспользуемые моды для уменьшения нагрузки</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle text-success mr-2 mt-1"></i>
                <span>Настройте параметры графики в модах для лучшей производительности</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({
      duration: 800,
      once: true,
      offset: 50
    });

    window.addEventListener('scroll', function() {
      const header = document.querySelector('header');
      if (window.scrollY > 10) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });
    
    const burgerBtn = document.getElementById('burgerBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    
    burgerBtn.addEventListener('click', function() {
      mobileMenu.classList.toggle('open');
      
      const lines = document.querySelectorAll('.burger-line');
      if (mobileMenu.classList.contains('open')) {
        lines[0].style.transform = 'translateY(7px) rotate(45deg)';
        lines[1].style.opacity = '0';
        lines[2].style.transform = 'translateY(-7px) rotate(-45deg)';
      } else {
        lines[0].style.transform = 'none';
        lines[1].style.opacity = '1';
        lines[2].style.transform = 'none';
      }
    });
    
    const menuItems = mobileMenu.querySelectorAll('a');
    menuItems.forEach(item => {
      item.addEventListener('click', () => {
        mobileMenu.classList.remove('open');
        const lines = document.querySelectorAll('.burger-line');
        lines[0].style.transform = 'none';
        lines[1].style.opacity = '1';
        lines[2].style.transform = 'none';
      });
    });

    const fileInput = document.getElementById('fileInput');
    const fileSelectBtn = document.getElementById('fileSelectBtn');
    const fileDropArea = document.getElementById('fileDropArea');
    const logInput = document.getElementById('logInput');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const clearBtn = document.getElementById('clearBtn');
    const sendLogBtn = document.getElementById('sendLogBtn');
    const resultContainer = document.getElementById('resultContainer');
    const emptyResult = document.getElementById('emptyResult');
    const errorSummary = document.getElementById('errorSummary');
    const errorDetails = document.getElementById('errorDetails');
    const solutions = document.getElementById('solutions');
    const logHistory = document.getElementById('logHistory');

    const errorDatabase = {
      "OutOfMemoryError": {
        title: "Недостаточно памяти",
        severity: "critical",
        description: "Minecraft исчерпал выделенную оперативную память.",
        solutions: [
          "Увеличьте выделенную память в настройках лаунчера",
          "Закройте лишние приложения, использующие память",
          "Установите мод оптимизации памяти (Sodium или OptiFine)"
        ]
      },
      "java.lang.OutOfMemoryError: Java heap space": {
        title: "Переполнение кучи Java",
        severity: "critical",
        description: "Программа превысила максимальный размер кучи, выделенный для Java.",
        solutions: [
          "Увеличьте значение -Xmx в аргументах JVM",
          "Убедитесь, что у вас установлена 64-битная версия Java",
          "Уменьшите настройки рендеринга или дальности прорисовки"
        ]
      },
      "OpenGL errors": {
        title: "Ошибки OpenGL",
        severity: "high",
        description: "Проблемы с видеодрайвером или поддержкой OpenGL.",
        solutions: [
          "Обновите драйверы видеокарты до последней версии",
          "Установите OptiFine для лучшей совместимости",
          "Попробуйте использовать другую версию Minecraft"
        ]
      },
      "GL_OUT_OF_MEMORY": {
        title: "Недостаточно видеопамяти",
        severity: "high",
        description: "Видеокарта исчерпала доступную видеопамять.",
        solutions: [
          "Уменьшите разрешение текстур (например, установите 16x вместо 32x)",
          "Уменьшите настройки графики в игре",
          "Закройте другие приложения, использующие видеокарту"
        ]
      },
      "mod conflict": {
        title: "Конфликт модов",
        severity: "high",
        description: "Два или более мода конфликтуют между собой.",
        solutions: [
          "Определите конфликтующие моды методом исключения",
          "Проверьте совместимость модов на официальных страницах",
          "Обновите моды до последней версии",
          "Убедитесь, что у вас установлены все необходимые библиотеки (Forge, Fabric)"
        ]
      },
      "missing mod dependency": {
        title: "Отсутствует зависимый мод",
        severity: "high",
        description: "Для работы одного из модов требуется другой мод, который не установлен.",
        solutions: [
          "Установите все необходимые зависимости мода",
          "Проверьте список зависимостей на странице мода",
          "Убедитесь, что версия зависимости совместима"
        ]
      },
      "mod requires": {
        title: "Требуется другой мод",
        severity: "medium",
        description: "Один из установленных модов требует наличия другого мода.",
        solutions: [
          "Установите мод, указанный в сообщении об ошибке",
          "Убедитесь, что версия требуемого мода совместима",
          "Если мод не нужен, удалите зависимый мод"
        ]
      },
      "NoSuchMethodError": {
        title: "Ошибка совместимости мода",
        severity: "high",
        description: "Мод вызывает метод, который отсутствует в текущей версии.",
        solutions: [
          "Обновите мод до последней версии",
          "Проверьте, совместим ли мод с вашей версией Minecraft",
          "Временно удалите мод и сообщите разработчику об ошибке"
        ]
      },
      "UnsupportedClassVersionError": {
        title: "Неподдерживаемая версия Java",
        severity: "critical",
        description: "Используется несовместимая версия Java для запуска Minecraft.",
        solutions: [
          "Установите Java 17 для новых версий Minecraft (1.17+)",
          "Для версий 1.16.5 и ниже используйте Java 8",
          "Проверьте настройки лаунчера - путь к Java"
        ]
      },
      "java.lang.NullPointerException": {
        title: "NullPointerException",
        severity: "medium",
        description: "Ошибка в коде мода или самой игры при обращении к неинициализированному объекту.",
        solutions: [
          "Обновите моды до последней версии",
          "Проверьте, воспроизводится ли ошибка без модов",
          "Сообщите автору мода об ошибке"
        ]
      },
      "Failed to download": {
        title: "Ошибка загрузки",
        severity: "medium",
        description: "Проблемы при загрузке файлов игры или ассетов.",
        solutions: [
          "Проверьте подключение к интернету",
          "Отключите VPN или прокси, если используете",
          "Очистите кэш лаунчера"
        ]
      },
      "404 Not Found": {
        title: "Ресурс не найден",
        severity: "medium",
        description: "Сервер не может найти запрашиваемый ресурс.",
        solutions: [
          "Попробуйте перезапустить лаунчер",
          "Очистите кэш лаунчера",
          "Проверьте работоспособность серверов Mojang"
        ]
      },
      "Game crashed": {
        title: "Крах игры",
        severity: "critical",
        description: "Minecraft аварийно завершил работу.",
        solutions: [
          "Обновите видеодрайверы",
          "Установите последнюю версию Java",
          "Проверьте целостность файлов игры"
        ]
      },
      "A fatal error has been detected": {
        title: "Критическая ошибка",
        severity: "critical",
        description: "Обнаружена фатальная ошибка, вызвавшая краш приложения.",
        solutions: [
          "Обновите операционную систему",
          "Проверьте оперативную память на ошибки",
          "Установите все системные обновления"
        ]
      },
      "Could not create the Java Virtual Machine": {
        title: "Ошибка создания виртуальной машины Java",
        severity: "critical",
        description: "Система не может запустить Java виртуальную машину.",
        solutions: [
          "Убедитесь, что Java установлена корректно",
          "Проверьте аргументы запуска JVM в настройках лаунчера",
          "Переустановите Java"
        ]
      },
      "java.lang.ClassNotFoundException": {
        title: "Класс не найден",
        severity: "high",
        description: "Отсутствует необходимый класс, обычно связанный с модом.",
        solutions: [
          "Переустановите проблемный мод",
          "Проверьте целостность файлов мода",
          "Убедитесь, что все зависимости установлены"
        ]
      },
      "java.lang.NoClassDefFoundError": {
        title: "Ошибка загрузки класса",
        severity: "high",
        description: "Система не может найти определение класса во время выполнения.",
        solutions: [
          "Проверьте наличие всех необходимых библиотек",
          "Убедитесь в совместимости версий модов",
          "Переустановите проблемный мод"
        ]
      },
      "java.lang.IllegalArgumentException": {
        title: "Недопустимый аргумент",
        severity: "medium",
        description: "Методу переданы недопустимые или некорректные аргументы.",
        solutions: [
          "Обновите мод до последней версии",
          "Проверьте конфигурационные файлы мода",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.ArrayIndexOutOfBoundsException": {
        title: "Выход за границы массива",
        severity: "medium",
        description: "Попытка доступа к элементу массива по индексу вне допустимых границ.",
        solutions: [
          "Обновите проблемный мод",
          "Удалите или замените поврежденные ресурспаки",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.net.SocketException": {
        title: "Ошибка сетевого соединения",
        severity: "medium",
        description: "Проблемы с сетевым подключением во время игры.",
        solutions: [
          "Проверьте интернет-соединение",
          "Отключите файервол или антивирус",
          "Перезагрузите роутер"
        ]
      },
      "java.io.IOException": {
        title: "Ошибка ввода/вывода",
        severity: "medium",
        description: "Проблемы с доступом к файлам или каталогам.",
        solutions: [
          "Проверьте права доступа к папке .minecraft",
          "Отключите антивирус на время игры",
          "Переустановите лаунчер"
        ]
      },
      "java.lang.StackOverflowError": {
        title: "Переполнение стека",
        severity: "critical",
        description: "Превышен размер стека вызовов из-за бесконечной рекурсии.",
        solutions: [
          "Обновите проблемные моды",
          "Увеличьте размер стека через аргументы JVM",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.AbstractMethodError": {
        title: "Ошибка абстрактного метода",
        severity: "high",
        description: "Попытка вызова абстрактного метода без реализации.",
        solutions: [
          "Проверьте совместимость версий модов",
          "Обновите все моды до последних версий",
          "Удалите конфликтующие моды"
        ]
      },
      "java.lang.VerifyError": {
        title: "Ошибка верификации байт-кода",
        severity: "high",
        description: "Ошибка при проверке байт-кода Java во время загрузки класса.",
        solutions: [
          "Убедитесь в совместимости версий Java и Minecraft",
          "Переустановите поврежденные моды",
          "Обновите Forge/Fabric Loader"
        ]
      },
      "java.lang.ClassCastException": {
        title: "Ошибка приведения типов",
        severity: "medium",
        description: "Попытка приведения объекта к несовместимому типу.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте конфигурации модов",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.ConcurrentModificationException": {
        title: "Ошибка параллельной модификации",
        severity: "medium",
        description: "Попытка изменения коллекции во время итерации.",
        solutions: [
          "Обновите проблемные моды",
          "Используйте синхронизированные коллекции",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.ExceptionInInitializerError": {
        title: "Ошибка инициализатора",
        severity: "high",
        description: "Исключение произошло во время выполнения статического инициализатора.",
        solutions: [
          "Проверьте целостность файлов мода",
          "Обновите Java до последней версии",
          "Убедитесь в совместимости модов"
        ]
      },
      "java.lang.IllegalStateException": {
        title: "Некорректное состояние",
        severity: "medium",
        description: "Метод вызван в недопустимом состоянии или в недопустимое время.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте последовательность загрузки модов",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.UnsatisfiedLinkError": {
        title: "Ошибка загрузки нативной библиотеки",
        severity: "high",
        description: "Система не может найти или загрузить нативную библиотеку.",
        solutions: [
          "Убедитесь, что установлены все необходимые системные библиотеки",
          "Проверьте путь к нативным библиотекам",
          "Переустановите проблемный мод"
        ]
      },
      "java.lang.InstantiationError": {
        title: "Ошибка создания экземпляра",
        severity: "high",
        description: "Попытка создать экземпляр абстрактного класса или интерфейса.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте совместимость версий модов",
          "Удалите конфликтующие моды"
        ]
      },
      "java.lang.IncompatibleClassChangeError": {
        title: "Несовместимое изменение класса",
        severity: "high",
        description: "Изменение в определении класса привело к несовместимости.",
        solutions: [
          "Обновите все моды до последних версий",
          "Проверьте совместимость версий модов",
          "Удалите устаревшие моды"
        ]
      },
      "java.lang.LinkageError": {
        title: "Ошибка связывания",
        severity: "high",
        description: "Несоответствие между классами во время связывания.",
        solutions: [
          "Очистите кэш лаунчера",
          "Переустановите проблемный мод",
          "Проверьте целостность файлов игры"
        ]
      },
      "java.lang.NoSuchFieldError": {
        title: "Ошибка отсутствующего поля",
        severity: "high",
        description: "Попытка доступа к несуществующему полю класса.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте совместимость версий модов",
          "Удалите конфликтующие моды"
        ]
      },
      "java.lang.ThreadDeath": {
        title: "Принудительное завершение потока",
        severity: "medium",
        description: "Поток был принудительно завершен вызовом метода stop().",
        solutions: [
          "Обновите проблемные моды",
          "Отключите моды, связанные с многопоточностью",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.VirtualMachineError": {
        title: "Ошибка виртуальной машины",
        severity: "critical",
        description: "Критическая ошибка в работе виртуальной машины Java.",
        solutions: [
          "Обновите Java до последней версии",
          "Увеличьте доступную память для Java",
          "Проверьте системные требования"
        ]
      },
      "java.security.AccessControlException": {
        title: "Ошибка контроля доступа",
        severity: "high",
        description: "Попытка выполнения запрещенной операции безопасности.",
        solutions: [
          "Проверьте настройки безопасности Java",
          "Обновите политики безопасности",
          "Запустите Minecraft с пониженными привилегиями"
        ]
      },
      "java.awt.AWTError": {
        title: "Ошибка графической подсистемы",
        severity: "critical",
        description: "Критическая ошибка в графической подсистеме Java.",
        solutions: [
          "Обновите драйверы видеокарты",
          "Попробуйте использовать другой рендер (OpenGL/DirectX)",
          "Переустановите Java"
        ]
      },
      "java.nio.BufferOverflowException": {
        title: "Переполнение буфера",
        severity: "medium",
        description: "Попытка записи данных за пределы буфера.",
        solutions: [
          "Обновите проблемный мод",
          "Увеличьте размер буфера через аргументы JVM",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.zip.ZipException": {
        title: "Ошибка архива",
        severity: "medium",
        description: "Проблема с чтением или записью ZIP-архива.",
        solutions: [
          "Проверьте целостность файлов модов",
          "Переустановите поврежденные моды",
          "Используйте другой архиватор для распаковки"
        ]
      },
      "java.util.MissingResourceException": {
        title: "Отсутствующий ресурс",
        severity: "medium",
        description: "Не найден необходимый файл ресурсов.",
        solutions: [
          "Проверьте наличие всех файлов ресурсов",
          "Переустановите проблемный мод",
          "Очистите кэш ресурсов Minecraft"
        ]
      },
      "java.lang.ArithmeticException": {
        title: "Арифметическая ошибка",
        severity: "medium",
        description: "Попытка выполнения недопустимой арифметической операции (например, деление на ноль).",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте конфигурации мода",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.NumberFormatException": {
        title: "Ошибка формата числа",
        severity: "medium",
        description: "Попытка преобразовать строку в неправильном формате в число.",
        solutions: [
          "Проверьте конфигурационные файлы",
          "Обновите проблемный мод",
          "Удалите поврежденные файлы конфигурации"
        ]
      },
      "java.lang.UnsupportedOperationException": {
        title: "Неподдерживаемая операция",
        severity: "medium",
        description: "Попытка выполнить операцию, которая не поддерживается.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте версию мода и Minecraft",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.nio.file.AccessDeniedException": {
        title: "Доступ запрещен",
        severity: "medium",
        description: "Попытка доступа к файлу или каталогу без необходимых прав.",
        solutions: [
          "Проверьте права доступа к папке .minecraft",
          "Запустите лаунчер от имени администратора",
          "Отключите антивирус на время игры"
        ]
      },
      "java.nio.file.NoSuchFileException": {
        title: "Файл не найден",
        severity: "medium",
        description: "Попытка доступа к несуществующему файлу или каталогу.",
        solutions: [
          "Проверьте целостность файлов игры",
          "Переустановите проблемный мод",
          "Очистите кэш лаунчера"
        ]
      },
      "java.lang.InterruptedException": {
        title: "Прерывание потока",
        severity: "low",
        description: "Поток был прерван во время выполнения операции.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте моды, связанные с многопоточностью",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.Concurrent.CancellationException": {
        title: "Отмена операции",
        severity: "low",
        description: "Попытка выполнить отмененную операцию.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте моды, связанные с многопоточностью",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.net.UnknownHostException": {
        title: "Неизвестный хост",
        severity: "medium",
        description: "Попытка подключения к неизвестному или недоступному серверу.",
        solutions: [
          "Проверьте подключение к интернету",
          "Убедитесь в правильности имени сервера",
          "Обновите сетевые настройки"
        ]
      },
      "java.net.ConnectException": {
        title: "Ошибка подключения",
        severity: "medium",
        description: "Попытка подключения к серверу, который недоступен.",
        solutions: [
          "Проверьте доступность сервера",
          "Отключите брандмауэр или антивирус",
          "Проверьте настройки прокси"
        ]
      },
      "java.lang.ClassCircularityError": {
        title: "Циклическая зависимость классов",
        severity: "high",
        description: "Обнаружена циклическая зависимость при инициализации классов.",
        solutions: [
          "Проверьте целостность установленных модов",
          "Удалите конфликтующие моды",
          "Обновите Forge/Fabric Loader"
        ]
      },
      "java.lang.InvocationTargetException": {
        title: "Ошибка вызова метода",
        severity: "high",
        description: "Исключение произошло во время вызова метода через reflection.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте совместимость версий модов",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.NoSuchMethodException": {
        title: "Метод не найден",
        severity: "high",
        description: "Попытка вызова несуществующего метода через reflection.",
        solutions: [
          "Обновите мод до последней версии",
          "Проверьте совместимость версий модов",
          "Временно удалите мод"
        ]
      },
      "java.lang.IllegalAccessError": {
        title: "Ошибка доступа",
        severity: "high",
        description: "Попытка доступа к недоступному методу или полю класса.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте совместимость версий модов",
          "Удалите конфликтующие моды"
        ]
      },
      "java.lang.AssertionError": {
        title: "Ошибка утверждения",
        severity: "medium",
        description: "Сбой в утверждении (assert) в коде программы.",
        solutions: [
          "Обновите проблемный мод",
          "Запустите игру с отключенными утверждениями (-da в аргументах JVM)",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.TypeNotPresentException": {
        title: "Тип не найден",
        severity: "high",
        description: "Запрашиваемый тип недоступен во время выполнения.",
        solutions: [
          "Проверьте наличие всех зависимостей",
          "Обновите проблемный мод",
          "Убедитесь в совместимости версий Java"
        ]
      },
      "java.lang.EnumConstantNotPresentException": {
        title: "Константа перечисления не найдена",
        severity: "medium",
        description: "Запрошенная константа перечисления отсутствует.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте конфигурации мода",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.annotation.AnnotationTypeMismatchException": {
        title: "Несоответствие типа аннотации",
        severity: "medium",
        description: "Попытка доступа к элементу аннотации с неверным типом.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте совместимость версий модов",
          "Удалите конфликтующие моды"
        ]
      },
      "java.lang.reflect.MalformedParameterizedTypeException": {
        title: "Некорректный параметризованный тип",
        severity: "high",
        description: "Ошибка в параметризованном типе во время выполнения.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте целостность файлов мода",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.lang.reflect.UndeclaredThrowableException": {
        title: "Необъявленное исключение",
        severity: "medium",
        description: "Исключение, не объявленное в сигнатуре метода.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте совместимость версий модов",
          "Удалите конфликтующие моды"
        ]
      },
      "java.nio.channels.ClosedChannelException": {
        title: "Канал закрыт",
        severity: "medium",
        description: "Попытка выполнения операции на закрытом канале ввода-вывода.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте моды, связанные с сетевым взаимодействием",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.nio.channels.FileLockInterruptionException": {
        title: "Прерывание блокировки файла",
        severity: "medium",
        description: "Попытка блокировки файла была прервана.",
        solutions: [
          "Обновите проблемные моды",
          "Отключите антивирусное ПО",
          "Проверьте доступ к файлам"
        ]
      },
      "java.sql.SQLException": {
        title: "Ошибка базы данных",
        severity: "medium",
        description: "Проблема при работе с базой данных.",
        solutions: [
          "Проверьте подключение к базе данных",
          "Обновите драйверы базы данных",
          "Проверьте логи базы данных"
        ]
      },
      "javax.net.ssl.SSLException": {
        title: "Ошибка SSL",
        severity: "medium",
        description: "Проблема с SSL-соединением.",
        solutions: [
          "Обновите сертификаты безопасности",
          "Проверьте системное время",
          "Отключите SSL-проверку (не рекомендуется)"
        ]
      },
      "java.awt.HeadlessException": {
        title: "Ошибка графического интерфейса",
        severity: "medium",
        description: "Попытка создания графического интерфейса в среде без дисплея.",
        solutions: [
          "Убедитесь, что сервер запущен в графической среде",
          "Используйте параметр -Djava.awt.headless=true",
          "Обновите настройки сервера"
        ]
      },
      "java.util.EmptyStackException": {
        title: "Пустой стек",
        severity: "medium",
        description: "Попытка извлечения элемента из пустого стека.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте логику работы мода",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.NoSuchElementException": {
        title: "Элемент не найден",
        severity: "medium",
        description: "Попытка доступа к несуществующему элементу коллекции.",
        solutions: [
          "Обновите проблемный мод",
          "Проверьте конфигурации мода",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.InputMismatchException": {
        title: "Несоответствие ввода",
        severity: "medium",
        description: "Получен ввод, который не соответствует ожидаемому типу.",
        solutions: [
          "Проверьте входные данные",
          "Обновите проблемный мод",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.IllegalFormatException": {
        title: "Недопустимый формат",
        severity: "medium",
        description: "Некорректный формат строки.",
        solutions: [
          "Проверьте форматирование строк",
          "Обновите проблемный мод",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.DuplicateFormatFlagsException": {
        title: "Дублирующиеся флаги формата",
        severity: "medium",
        description: "Обнаружены дублирующиеся флаги в строке формата.",
        solutions: [
          "Проверьте строки форматирования",
          "Обновите проблемный мод",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.MissingFormatArgumentException": {
        title: "Отсутствует аргумент формата",
        severity: "medium",
        description: "Отсутствует аргумент для спецификатора формата.",
        solutions: [
          "Проверьте строки форматирования",
          "Обновите проблемный мод",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.MissingFormatWidthException": {
        title: "Отсутствует ширина формата",
        severity: "medium",
        description: "Отсутствует ширина для спецификатора формата.",
        solutions: [
          "Проверьте строки форматирования",
          "Обновите проблемный мод",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.UnknownFormatConversionException": {
        title: "Неизвестное преобразование формата",
        severity: "medium",
        description: "Обнаружен неизвестный спецификатор преобразования.",
        solutions: [
          "Проверьте строки форматирования",
          "Обновите проблемный мод",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.UnknownFormatFlagsException": {
        title: "Неизвестный флаг формата",
        severity: "medium",
        description: "Обнаружен неизвестный флаг в спецификаторе формата.",
        solutions: [
          "Проверьте строки форматирования",
          "Обновите проблемный мод",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.IllformedLocaleException": {
        title: "Некорректная локаль",
        severity: "medium",
        description: "Переданы некорректные параметры локали.",
        solutions: [
          "Проверьте настройки локализации",
          "Обновите проблемный мод",
          "Установите системную локаль"
        ]
      },
      "java.util.ServiceConfigurationError": {
        title: "Ошибка конфигурации сервиса",
        severity: "high",
        description: "Ошибка при загрузке конфигурации сервиса.",
        solutions: [
          "Проверьте файлы конфигурации сервисов",
          "Обновите проблемный мод",
          "Переустановите поврежденные сервисы"
        ]
      },
      "java.util.concurrent.CancellationException": {
        title: "Операция отменена",
        severity: "medium",
        description: "Попытка получить результат отмененной операции.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте многопоточные операции",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.concurrent.CompletionException": {
        title: "Ошибка завершения",
        severity: "medium",
        description: "Исключение, возникшее при завершении асинхронной операции.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте асинхронные операции",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.concurrent.ExecutionException": {
        title: "Ошибка выполнения",
        severity: "medium",
        description: "Исключение, возникшее при попытке получить результат задачи.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте выполнение задач",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.concurrent.RejectedExecutionException": {
        title: "Отклоненное выполнение",
        severity: "medium",
        description: "Попытка отправить задачу в закрытый пул потоков.",
        solutions: [
          "Обновите проблемные моды",
          "Проверьте управление потоками",
          "Сообщите разработчику мода об ошибке"
        ]
      },
      "java.util.concurrent.TimeoutException": {
        title: "Тайм-аут операции",
        severity: "medium",
        description: "Истекло время ожидания выполнения операции.",
        solutions: [
          "Увеличьте время ожидания",
          "Проверьте производительность системы",
          "Оптимизируйте ресурсоемкие операции"
        ]
      }
    };

    fileSelectBtn.addEventListener('click', () => fileInput.click());
    
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = (event) => {
          logInput.value = event.target.result;
          addToLogHistory(`Загружен файл: ${file.name}`);
        };
        
        reader.readAsText(file);
      }
    });
    
    fileDropArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileDropArea.classList.add('active');
    });
    
    fileDropArea.addEventListener('dragleave', () => {
      fileDropArea.classList.remove('active');
    });
    
    fileDropArea.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDropArea.classList.remove('active');
      
      if (e.dataTransfer.files.length > 0) {
        const file = e.dataTransfer.files[0];
        const reader = new FileReader();
        
        reader.onload = (event) => {
          logInput.value = event.target.result;
          addToLogHistory(`Перетащен файл: ${file.name}`);
        };
        
        reader.readAsText(file);
      }
    });
    
    analyzeBtn.addEventListener('click', () => {
      const logText = logInput.value.trim();
      
      if (logText.length === 0) {
        showNotification("Пожалуйста, введите или загрузите лог для анализа", "error");
        return;
      }
      
      const analysisResult = analyzeLog(logText);
      displayResults(analysisResult);
      addToLogHistory(`Выполнен анализ лога (${analysisResult.errors.length} ошибок)`);
    });
    
    clearBtn.addEventListener('click', () => {
      logInput.value = '';
      fileInput.value = '';
      resultContainer.classList.add('hidden');
      emptyResult.classList.remove('hidden');
    });
    
    sendLogBtn.addEventListener('click', () => {
      const logText = logInput.value.trim();
      if (logText.length === 0) {
        showNotification("Пожалуйста, введите или загрузите лог для отправки", "error");
        return;
      }
      
      window.open('https://t.me/sun_community_chat/937', '_blank');
    });
    
    async function translateWithMyMemory(text) {
      try {
        if (text.length > 5000) {
          return "Лог слишком длинный для перевода. Пожалуйста, отправьте файл напрямую.";
        }
        
        const response = await fetch(
          `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|ru`
        );
        
        if (!response.ok) {
          throw new Error(`Ошибка HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data && data.responseData && data.responseData.translatedText) {
          return data.responseData.translatedText;
        } else {
          throw new Error('Перевод не найден в ответе API');
        }
      } catch (error) {
        console.error('Ошибка перевода:', error);
        throw new Error('Не удалось выполнить перевод. Попробуйте позже или отправьте лог вручную.');
      }
    }
    
    function showNotification(message, type = "info") {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="notification-title">
          <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'} mr-2"></i>
          ${type === 'error' ? 'Ошибка' : 'Успех'}
        </div>
        <p>${message}</p>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('show');
      }, 10);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 400);
      }, 5000);
    }
    
    function analyzeLog(logText) {
      const errors = [];
      const lines = logText.split('\n');
      
      for (const [pattern, errorInfo] of Object.entries(errorDatabase)) {
        const regex = new RegExp(pattern, 'i');
        const matches = logText.match(regex);
        
        if (matches) {
          const errorLines = lines.filter(line => regex.test(line));
          
          errors.push({
            ...errorInfo,
            pattern: pattern,
            occurrences: matches.length,
            lines: errorLines
          });
        }
      }
      
      const severityOrder = {critical: 0, high: 1, medium: 2, low: 3};
      errors.sort((a, b) => severityOrder[a.severity] - severityOrder[b.severity]);
      
      const unknownErrors = [];
      const errorRegex = /error|exception|crash|fail|warning|ошибка|исключение|краш|сбой|предупреждение/gi;
      const knownPatterns = Object.keys(errorDatabase);
      
      lines.forEach((line, index) => {
        if (errorRegex.test(line)) {
          const isKnown = knownPatterns.some(pattern => {
            const regex = new RegExp(pattern, 'i');
            return regex.test(line);
          });
          
          if (!isKnown) {
            unknownErrors.push({
              title: "Неизвестная ошибка",
              severity: "medium",
              description: "Обнаружена нераспознанная ошибка. Скопируйте и отправьте в поддержку",
              pattern: "unknown",
              occurrences: 1,
              lines: [line]
            });
          }
        }
      });
      
      return {
        errors: [...errors, ...unknownErrors],
        lineCount: lines.length,
        errorCount: errors.length + unknownErrors.length
      };
    }
    
    function displayResults(result) {
      resultContainer.classList.remove('hidden');
      emptyResult.classList.add('hidden');
      
      errorSummary.innerHTML = '';
      errorDetails.innerHTML = '';
      solutions.innerHTML = '';
      
      if (result.errors.length === 0) {
        errorSummary.innerHTML = `
          <div class="bg-success/20 p-4 rounded-lg text-center">
            <i class="fas fa-check-circle text-success text-3xl mb-3"></i>
            <p class="text-lg font-medium">Ошибки не обнаружены!</p>
            <p class="text-gray-300 mt-2">Ваш лог-файл не содержит известных проблем. Пожалуйста обратитесь в поддержку.</p>
          </div>
        `;
      } else {
        const groupedErrors = {
          critical: result.errors.filter(e => e.severity === 'critical'),
          high: result.errors.filter(e => e.severity === 'high'),
          medium: result.errors.filter(e => e.severity === 'medium'),
          low: result.errors.filter(e => e.severity === 'low')
        };
        
        let summaryHTML = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="p-4 rounded-lg ${groupedErrors.critical.length ? 'bg-error/20' : 'bg-gray-700'}">
              <div class="flex justify-between items-center">
                <span class="font-bold">Критические ошибки:</span>
                <span class="text-2xl font-bold ${groupedErrors.critical.length ? 'text-error' : 'text-gray-400'}">${groupedErrors.critical.length}</span>
              </div>
            </div>
            
            <div class="p-4 rounded-lg ${groupedErrors.high.length ? 'bg-error/20' : 'bg-gray-700'}">
              <div class="flex justify-between items-center">
                <span class="font-bold">Высокая важность:</span>
                <span class="text-2xl font-bold ${groupedErrors.high.length ? 'text-error' : 'text-gray-400'}">${groupedErrors.high.length}</span>
              </div>
            </div>
            
            <div class="p-4 rounded-lg ${groupedErrors.medium.length ? 'bg-warning/20' : 'bg-gray-700'}">
              <div class="flex justify-between items-center">
                <span class="font-bold">Средняя важность:</span>
                <span class="text-2xl font-bold ${groupedErrors.medium.length ? 'text-warning' : 'text-gray-400'}">${groupedErrors.medium.length}</span>
              </div>
            </div>
            
            <div class="p-4 rounded-lg ${groupedErrors.low.length ? 'bg-primary/20' : 'bg-gray-700'}">
              <div class="flex justify-between items-center">
                <span class="font-bold">Низкая важность:</span>
                <span class="text-2xl font-bold ${groupedErrors.low.length ? 'text-primary' : 'text-gray-400'}">${groupedErrors.low.length}</span>
              </div>
            </div>
          </div>
        `;
        
        errorSummary.innerHTML = summaryHTML;
        
        result.errors.forEach((error, index) => {
          const severityClass = `severity-${error.severity}`;
          
          const errorHTML = `
            <div class="${severityClass} p-4 rounded-lg" id="error-${index}">
              <div class="flex justify-between items-start">
                <div>
                  <h5 class="font-bold text-lg">${index + 1}. ${error.title}</h5>
                  <p class="text-gray-300 text-sm mt-1">${error.description}</p>
                </div>
                <div class="flex items-center">
                  <span class="error-tag">${error.severity === 'critical' ? 'Критично' : 
                    error.severity === 'high' ? 'Высокая' : 
                    error.severity === 'medium' ? 'Средняя' : 'Низкая'}</span>
                  <button class="translate-error-btn ml-2 text-primary hover:text-primary-dark text-sm" data-error-index="${index}">
                    <i class="fas fa-language"></i>
                  </button>
                </div>
              </div>
              
              <div class="mt-3">
                <p class="text-gray-400 text-sm">Найдено вхождений: ${error.occurrences}</p>
                <div class="mt-2 max-h-24 overflow-y-auto bg-gray-900/50 p-2 rounded" id="error-lines-${index}">
                  ${error.lines.slice(0, 5).map(line => 
                    `<div class="log-line text-xs">${line}</div>`
                  ).join('')}
                  ${error.lines.length > 5 ? `<div class="text-gray-500 text-xs mt-1">...и еще ${error.lines.length - 5} строк</div>` : ''}
                </div>
              </div>
            </div>
          `;
          
          errorDetails.innerHTML += errorHTML;
        });
        
        document.querySelectorAll('.translate-error-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const errorIndex = this.getAttribute('data-error-index');
            translateErrorLines(errorIndex);
          });
        });
        
        const uniqueSolutions = new Set();
        
        result.errors.forEach(error => {
          if (error.solutions) {
            error.solutions.forEach(solution => uniqueSolutions.add(solution));
          }
        });
        
        if (uniqueSolutions.size > 0) {
          solutions.innerHTML = Array.from(uniqueSolutions).map((solution, i) => `
            <div class="flex items-start">
              <div class="w-6 h-6 rounded-full bg-success/20 flex items-center justify-center mr-3 mt-1 flex-shrink-0">
                <span class="text-success text-xs">${i + 1}</span>
              </div>
              <p>${solution}</p>
            </div>
          `).join('');
        } else {
          solutions.innerHTML = `
            <div class="text-gray-400 italic">
              Для данных ошибок нет специфических решений. Пожалуйста обратитесь в поддержку.
            </div>
          `;
        }
      }
    }
    
    async function translateErrorLines(errorIndex) {
      const errorElement = document.getElementById(`error-${errorIndex}`);
      if (!errorElement) return;
      
      const errorLinesElement = document.getElementById(`error-lines-${errorIndex}`);
      if (!errorLinesElement) return;
      
      const translateBtn = errorElement.querySelector('.translate-error-btn');
      if (!translateBtn) return;
      
      if (translateBtn.classList.contains('translating')) return;
      
      translateBtn.classList.add('translating');
      translateBtn.innerHTML = '<i class="fas fa-spinner spinner"></i>';
      
      try {
        const errorLines = [];
        errorLinesElement.querySelectorAll('.log-line').forEach(line => {
          if (!line.classList.contains('translated')) {
            errorLines.push(line.textContent);
          }
        });
        
        if (errorLines.length === 0) {
          showNotification("Нет строк для перевода", "info");
          return;
        }
        
        const translatedLines = [];
        for (const line of errorLines) {
          const translated = await translateWithMyMemory(line);
          translatedLines.push(translated);
        }
        
        let translatedContent = '';
        translatedLines.forEach((line, i) => {
          translatedContent += `<div class="log-line text-xs translated">${line}</div>`;
          if (i === 4 && translatedLines.length > 5) {
            translatedContent += `<div class="text-gray-500 text-xs mt-1">...и еще ${translatedLines.length - 5} строк переведено</div>`;
          }
        });
        
        errorLinesElement.innerHTML = translatedContent;
        showNotification("Строки ошибки переведены", "success");
      } catch (error) {
        console.error("Ошибка перевода:", error);
        showNotification(error.message || "Ошибка перевода", "error");
      } finally {
        translateBtn.classList.remove('translating');
        translateBtn.innerHTML = '<i class="fas fa-language"></i>';
      }
    }
    
    function addToLogHistory(message) {
      const now = new Date();
      const timeString = now.toLocaleTimeString();
      
      const logEntry = `
        <div class="log-line flex items-center text-sm">
          <span class="text-gray-500 mr-2">[${timeString}]</span>
          <span>${message}</span>
        </div>
      `;
      
      logHistory.innerHTML = logEntry + logHistory.innerHTML;
      
      if (logHistory.children.length > 10) {
        logHistory.removeChild(logHistory.lastChild);
      }
    }
    
    addToLogHistory("Анализатор запущен. Загрузите лог для анализа.");
  </script>
</body>
</html>
